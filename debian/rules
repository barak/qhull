#!/usr/bin/make -f

# Uncomment this to turn on verbose mode.
#export DH_VERBOSE=1

# consider: GCC -fno-strict-aliasing

$(dh_targets) %:
	dh $@ --with autoreconf --parallel

override_dh_autoreconf:
	$(SHELL) config/bootstrap.sh	# robust to non-executable script

override_dh_auto_build:
	dh_auto_build
	@echo Building man pages
	cd debian &&							\
	  for info in "qconvex:compute the convex hull"			\
	              "qdelaunay:compute the Delaunay triangulation"	\
	              "qhalf:halfspace intersection about a point"	\
	              "qvoronoi:compute the Voronoi diagram" ; do	\
	      comm=$$(echo  $$info | cut -d: -f1) &&			\
	      purp=$$(echo  $$info | cut -d: -f2) &&			\
	      echo -n Building man page for $$comm... &&		\
	      sed "s/#command#/$$comm/;s/#purpose#/$$purp/"		\
	          manpage.in > $$comm.xml &&				\
	      docbook2x-man $$comm.xml &&				\
	      echo " done" ;						\
	  done

override_dh_auto_test:
	env PATH=$(CURDIR)/src:$${PATH} eg/q_test

override_dh_installchangelogs:
	dh_installchangelogs src/Changes.txt

override_dh_compress:
	dh_compress -X.c -X.h -X.txt
