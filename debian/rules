#!/usr/bin/make -f
# debian/rules for Debian qhull package
# GNU copyright 2007 by Rafael Laboissiere

include /usr/share/cdbs/1/rules/debhelper.mk
include /usr/share/cdbs/1/class/autotools.mk
include /usr/share/cdbs/1/rules/simple-patchsys.mk

debdir	:= $(CURDIR)/debian
deblin	:= $(debdir)/libqhull-dev/usr/share/lintian/overrides
htmldir	:= $(debdir)/tmp/usr/share/doc/qhull/html

DEB_DH_INSTALL_SOURCEDIR = debian/tmp
DEB_COMPRESS_EXCLUDE = .c .h .txt

build/qhull-bin::
	@( cd debian ;							\
	  for info in "qconvex:compute the convex hull"			\
	              "qdelaunay:compute the Delaunay triangulation"	\
	              "qhalf:halfspace intersection about a point"	\
	              "qvoronoi:compute the Voronoi diagram" ; do	\
	      comm=`echo  $$info | cut -d: -f1` ;			\
	      purp=`echo  $$info | cut -d: -f2` ;			\
	      echo -n Building man page for $$comm... ;			\
	      eperl -d command=$$comm -d purpose="$$purp"		\
	          manpage.in > $$comm.xml ;				\
	      docbook2x-man $$comm.xml ;				\
	      echo " done" ;						\
	  done )

clean::
	rm -f debian/*.xml debian/*.1

install/libqhull-dev::
	# Install all the needed documentation files
	cp *.txt html/*.txt $(htmldir)
	mkdir $(htmldir)/src
	cp src/*.{c,h,htm,txt} $(htmldir)/src
	sed -i 's:href="../:href=":g' $(htmldir)/*.htm
	# Isntall Lintian override file
	mkdir -p $(deblin)
	install --mode=644 $(debdir)/libqhull-dev.lintian \
		$(deblin)/libqhull-dev
